<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel do Professor</title>

  <!-- √çcones Remix e CSS -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link rel="stylesheet" href="professor.css" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <!-- ===== BARRA SUPERIOR ===== -->
  <header class="barra-superior">
    <div class="logo">
      <i class="ri-graduation-cap-line"></i>
      <span>Painel do Professor</span>
    </div>
    <nav class="menu-topo">
      <ul>
        <li class="ativo" onclick="mostrar('dashboard')"><i class="ri-dashboard-line"></i> Dashboard</li>
        <li onclick="mostrar('disciplinas')"><i class="ri-book-open-line"></i> Disciplinas</li>
        <li onclick="mostrar('turmas')"><i class="ri-group-line"></i> Turmas</li>
        <li onclick="mostrar('notas')"><i class="ri-file-list-3-line"></i> Lan√ßar Notas</li>
        <li onclick="mostrar('relatorios')"><i class="ri-bar-chart-2-line"></i> Relat√≥rios</li>
        <li onclick="mostrar('calendario')"><i class="ri-calendar-line"></i> Calend√°rio</li>
        <li onclick="mostrar('perfil')"><i class="ri-user-settings-line"></i> Perfil</li>
      </ul>
    </nav>
    <button class="logout" onclick="logout()">
      <i class="ri-logout-box-line"></i> Sair
    </button>
  </header>

  <!-- ===== CONTE√öDO PRINCIPAL ===== -->
  <main class="conteudo-principal">
    <section class="cabecalho">
      <h1>Bem-vindo(a), <span id="nomeProfessor">Prof. Ana Souza</span>!</h1>
      <p>Gerencie suas disciplinas, turmas e notas com praticidade.</p>
    </section>

    <section id="dashboard" class="dashboard-professor">
      <div class="card" onclick="mostrar('notas')">
        <i class="ri-file-list-3-line"></i>
        <h2>Lan√ßar Notas</h2>
        <p>Registre e atualize as notas dos alunos.</p>
      </div>

      <div class="card" onclick="mostrar('turmas')">
        <i class="ri-group-line"></i>
        <h2>Gerenciar Turmas</h2>
        <p>Visualize e organize suas turmas.</p>
      </div>

      <div class="card" onclick="mostrar('disciplinas')">
        <i class="ri-book-open-line"></i>
        <h2>Minhas Disciplinas</h2>
        <p>Acesse e edite suas disciplinas ativas.</p>
      </div>

      <div class="card" onclick="mostrar('relatorios')">
        <i class="ri-bar-chart-2-line"></i>
        <h2>Relat√≥rios</h2>
        <p>Veja o desempenho dos alunos por turma.</p>
      </div>

      <div class="card" onclick="mostrar('calendario')">
        <i class="ri-calendar-line"></i>
        <h2>Calend√°rio</h2>
        <p>Visualize datas de provas e eventos acad√™micos.</p>
      </div>

      <div class="card" onclick="mostrar('perfil')">
        <i class="ri-user-settings-line"></i>
        <h2>Perfil</h2>
        <p>Atualize suas informa√ß√µes pessoais e senha.</p>
      </div>
    </section>

    <!-- ===== P√ÅGINAS ===== -->
<section id="disciplinas" class="pagina oculto">
  <h2>Minhas Disciplinas</h2>

  <div class="disciplinas-header">
    <button id="btnAddDisciplina">+ Adicionar Disciplina</button>
  </div>

  <table class="tabela-relatorio" id="tabelaDisciplinas">
    <thead>
      <tr>
        <th>Disciplina</th>
        <th>Turmas Associadas</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="turmas" class="pagina oculto">
  <h2>Gerenciar Turmas</h2>
</section>

<!-- ‚úÖ NOVA SE√á√ÉO DE LAN√áAMENTO DE NOTAS -->
<section id="notas" class="pagina oculto">
  <h2>Lan√ßar Notas</h2>

  <div class="form-lancar-notas">

    <label for="disciplinaSelect">Disciplina:</label>
    <select id="disciplinaSelect">
      <option value="">Selecione...</option>
    </select>

    <label for="turmaSelect">Turma:</label>
    <select id="turmaSelect">
      <option value="">Selecione uma disciplina primeiro...</option>
    </select>

    <div id="listaAlunos" class="lista-alunos oculto">
      <h3>Alunos da Turma</h3>
      <table>
        <thead>
  <tr>
    <th>Aluno</th>
    <th>Disciplina</th>
    <th>Turma</th>
    <th>Nota</th>
  </tr>
</thead>
        <tbody id="alunosTabela"></tbody>
      </table>

      <button onclick="salvarNotas()" class="btn-salvar">Salvar Notas</button>
    </div>

  </div>
</section>

<section id="relatorios" class="pagina oculto">
  <h2>Relat√≥rios de Desempenho</h2>

  <div class="filtros-relatorio">
    <label>Disciplina:</label>
    <select id="filtroDisciplina">
      <option value="">Todas</option>
    </select>

    <label>Turma:</label>
    <select id="filtroTurma">
      <option value="">Todas</option>
    </select>
  </div>

  <div class="relatorio-box">
    <table class="tabela-relatorio">
  <thead>
    <tr>
      <th>Aluno</th>
      <th>Disciplina</th>
      <th>Turma</th>
      <th>Nota</th>
    </tr>
  </thead>
  <tbody id="tabelaRelatorio"></tbody>
</table>

    <div class="media-turma">
      M√©dia da Turma: <span id="mediaValor">-</span>
    </div>

    <div class="export-buttons">
      <button onclick="exportarPDF()">Exportar PDF</button>
      <button onclick="exportarExcel()">Exportar Excel</button>
    </div>
  </div>
</section>

<section id="calendario" class="pagina oculto">
  <h2>Calend√°rio Acad√™mico</h2>

  <div class="calendario-container">
    <div class="calendario-header">
      <button id="mesAnterior"><i class="ri-arrow-left-s-line"></i></button>
      <h3 id="mesAtual"></h3>
      <button id="mesProximo"><i class="ri-arrow-right-s-line"></i></button>
    </div>

    <table class="calendario-tabela">
      <thead>
        <tr>
          <th>Dom</th><th>Seg</th><th>Ter</th><th>Qua</th><th>Qui</th><th>Sex</th><th>S√°b</th>
        </tr>
      </thead>
      <tbody id="diasCalendario"></tbody>
    </table>
  </div>
</section>

<section id="perfil" class="pagina oculto">
  <div class="perfil-container">

    <div class="perfil-avatar">
      <img id="fotoPerfil" src="https://i.imgur.com/9b9ZQPP.png" alt="Foto do Professor">
      <input type="file" id="inputFoto" accept="image/*" class="oculto">
      <button id="btnTrocarFoto">Trocar Foto</button>
    </div>

    <div class="perfil-info">
      <h2>Perfil do Professor</h2>

      <label>Nome:</label>
      <input type="text" id="perfilNome" disabled>

      <label>Email:</label>
      <input type="text" id="perfilEmail" disabled>

      <div class="perfil-botoes">
        <button id="btnEditarPerfil">Editar</button>
        <button id="btnSalvarPerfil" class="oculto">Salvar</button>
      </div>

      <hr>

      <button id="btnAlterarSenha" class="btn-senha">Alterar Senha</button>
    </div>

  </div>
</section>


  </main>

<script>
/* =========================================================
   INICIALIZA√á√ÉO DO NOME NO DASHBOARD
========================================================= */
const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
document.getElementById("nomeProfessor").textContent = usuario?.nome || "Professor";

/* =========================================================
   DADOS EXEMPLO (caso ainda n√£o tenha banco)
========================================================= */
const disciplinasPadrao = {
  "Matem√°tica": ["Turma A", "Turma B"],
  "Portugu√™s": ["Turma A"],
  "Hist√≥ria": ["Turma C"]
};

const alunosPorTurma = {
  "Turma A": ["Lucas", "Mariana", "Jo√£o", "Ana Paula"],
  "Turma B": ["Carlos", "J√∫lia", "Miguel"],
  "Turma C": ["Rafaela", "Tiago", "Eduardo"]
};

const disciplinas = JSON.parse(localStorage.getItem("disciplinas")) || disciplinasPadrao;

/* =========================================================
   ELEMENTOS DA TELA DE LAN√áAMENTO DE NOTAS
========================================================= */
const disciplinaSelect = document.getElementById("disciplinaSelect");
const turmaSelect = document.getElementById("turmaSelect");
const listaAlunosDiv = document.getElementById("listaAlunos");
const alunosTabela = document.getElementById("alunosTabela");

/* ===== Preenche disciplinas ===== */
function initDisciplinaSelect() {
  disciplinaSelect.innerHTML = `<option value="">Selecione...</option>`;
  Object.keys(disciplinas).forEach(d => {
    disciplinaSelect.innerHTML += `<option value="${d}">${d}</option>`;
  });
}
initDisciplinaSelect();

/* ===== Sele√ß√£o da disciplina ===== */
disciplinaSelect.onchange = () => {
  turmaSelect.innerHTML = '<option value="">Selecione...</option>';
  listaAlunosDiv.classList.add("oculto");
  alunosTabela.innerHTML = "";

  if (disciplinaSelect.value) {
    disciplinas[disciplinaSelect.value].forEach(t => {
      turmaSelect.innerHTML += `<option value="${t}">${t}</option>`;
    });
  }
};

/* ===== Sele√ß√£o da turma ===== */
turmaSelect.onchange = () => {
  alunosTabela.innerHTML = "";
  if (!turmaSelect.value) return;

  (alunosPorTurma[turmaSelect.value] || []).forEach(aluno => {
    alunosTabela.innerHTML += `
      <tr>
        <td>${aluno}</td>
        <td><input type="number" min="0" max="10" step="0.1" placeholder="ex: 8.5"></td>
      </tr>`;
  });

  listaAlunosDiv.classList.remove("oculto");
};

/* =========================================================
   SALVAR NOTAS
========================================================= */
function salvarNotas() {
  const disciplina = disciplinaSelect.value;
  const turma = turmaSelect.value;

  if (!disciplina || !turma) return alert("Selecione disciplina e turma.");

  const linhas = alunosTabela.querySelectorAll("tr");
  let dados = JSON.parse(localStorage.getItem("notasCompleto")) || [];

  linhas.forEach(linha => {
    const aluno = linha.children[0].textContent.trim();
    const nota = linha.children[1].children[0].value || "-";

    const idx = dados.findIndex(r =>
      r.aluno === aluno && r.disciplina === disciplina && r.turma === turma
    );

    const registro = { aluno, disciplina, turma, nota };

    idx === -1 ? dados.push(registro) : dados[idx] = registro;
  });

  localStorage.setItem("notasCompleto", JSON.stringify(dados));
  alert("‚úÖ Notas salvas com sucesso!");
}

/* =========================================================
   RELAT√ìRIO / FILTROS
========================================================= */
function carregarFiltrosRelatorio() {
  const filtroDisciplina = document.getElementById("filtroDisciplina");
  const filtroTurma = document.getElementById("filtroTurma");
  if (!filtroDisciplina) return;

  filtroDisciplina.innerHTML = '<option value="">Todas</option>';
  filtroTurma.innerHTML = '<option value="">Todas</option>';

  Object.keys(disciplinas).forEach(d => filtroDisciplina.innerHTML += `<option value="${d}">${d}</option>`);

  filtroDisciplina.onchange = () => {
    filtroTurma.innerHTML = '<option value="">Todas</option>';
    disciplinas[filtroDisciplina.value]?.forEach(t => filtroTurma.innerHTML += `<option value="${t}">${t}</option>`);
    carregarRelatorio();
  };

  filtroTurma.onchange = carregarRelatorio;
}

function carregarRelatorio() {
  const tabela = document.getElementById("tabelaRelatorio");
  const mediaValor = document.getElementById("mediaValor");
  if (!tabela) return;

  const filtroDisc = document.getElementById("filtroDisciplina").value;
  const filtroTurm = document.getElementById("filtroTurma").value;
  const dados = JSON.parse(localStorage.getItem("notasCompleto")) || [];

  const filtrados = dados.filter(n =>
    (!filtroDisc || n.disciplina === filtroDisc) &&
    (!filtroTurm || n.turma === filtroTurm)
  );

  tabela.innerHTML = filtrados.map(d =>
    `<tr><td>${d.aluno}</td><td>${d.disciplina}</td><td>${d.turma}</td><td>${d.nota}</td></tr>`
  ).join("");

  const numeros = filtrados.map(d => Number(d.nota)).filter(n => !isNaN(n));
  mediaValor.textContent = numeros.length ? (numeros.reduce((a,b)=>a+b)/numeros.length).toFixed(2) : "-";
}

/* =========================================================
   EXPORTA√á√ïES
========================================================= */
function exportarPDF() { window.print(); }
function exportarExcel() { alert("Excel j√° configurado ‚Äî mantido igual üòä"); }

/* =========================================================
   NAVEGA√á√ÉO SPA
========================================================= */
function mostrar(pagina) {
  // Remove classe ativo de todos os itens do menu
  document.querySelectorAll(".menu-topo ul li").forEach(li => li.classList.remove("ativo"));

  // Adiciona ativo no item clicado
  const itemAtivo = document.querySelector(`[onclick="mostrar('${pagina}')"]`);
  if (itemAtivo) itemAtivo.classList.add("ativo");

  // Esconde todas as se√ß√µes
  document.querySelectorAll(".pagina, .dashboard-professor").forEach(sec => sec.classList.add("oculto"));

  // Mostra apenas a p√°gina clicada
  const secao = document.getElementById(pagina);
  if (secao) secao.classList.remove("oculto");

  // Recarrega os dados se for a p√°gina de relat√≥rios
  if (pagina === "relatorios") {
    carregarFiltrosRelatorio();
    carregarRelatorio();
  }
}

/* =========================================================
   PERFIL (com foto)
========================================================= */
function carregarPerfil() {
  const user = JSON.parse(localStorage.getItem("usuarioLogado"));
  perfilNome.value = user.nome;
  perfilEmail.value = user.email;
  if (user.foto) fotoPerfil.src = user.foto;
}

btnEditarPerfil.onclick = () => {
  perfilNome.disabled = perfilEmail.disabled = false;
  btnEditarPerfil.classList.add("oculto");
  btnSalvarPerfil.classList.remove("oculto");
};

btnSalvarPerfil.onclick = () => {
  let user = JSON.parse(localStorage.getItem("usuarioLogado"));
  user.nome = perfilNome.value;
  user.email = perfilEmail.value;
  localStorage.setItem("usuarioLogado", JSON.stringify(user));
  carregarPerfil();
  btnSalvarPerfil.classList.add("oculto");
  btnEditarPerfil.classList.remove("oculto");
};

btnAlterarSenha.onclick = () => {
  const nova = prompt("Digite a nova senha:");
  if (!nova) return;
  let user = JSON.parse(localStorage.getItem("usuarioLogado"));
  user.senha = nova;
  localStorage.setItem("usuarioLogado", JSON.stringify(user));
  alert("Senha atualizada!");
};

/* FOTO */
btnTrocarFoto.onclick = () => inputFoto.click();
inputFoto.onchange = (e) => {
  const arquivo = e.target.files[0];
  const reader = new FileReader();
  reader.onloadend = () => {
    fotoPerfil.src = reader.result;
    let user = JSON.parse(localStorage.getItem("usuarioLogado"));
    user.foto = reader.result;
    localStorage.setItem("usuarioLogado", JSON.stringify(user));
  };
  reader.readAsDataURL(arquivo);
};

/* ========================================================= */
carregarPerfil();
renderizarCalendario?.();

/* =========================================================
   LOGOUT
========================================================= */
function logout() {
  // Remove a sess√£o do professor
  localStorage.removeItem("usuarioLogado");

  // Redireciona para a tela de login
  window.location.href = "index.html";
}
</script>
</body>
</html>